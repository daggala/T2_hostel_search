package hotelSearch;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;

public class BookingManager {
	
	private final String DB_DRIVER;
	private final String DB_CONNECTION;
	
	public BookingManager(){
		DB_DRIVER = "org.sqlite.JDBC";
		DB_CONNECTION = "jdbc:sqlite:/Users/dagny/Documents/HotelSearch/T2_hostel_search/HotelSearch/HotelData";
	}			
	
	public void reduceAvailability(Hotel hotel, Request request) throws ConnectException{

		Connection c = null;
	    PreparedStatement statement = null;
	    
	    ArrayList<String> dayList = new ArrayList<String>();
	    StayLength staylength = request.getDate();
	    dayList = staylength.getDatesOfStay();
	
	    
	    //for(int i=0; i< staylength.getDuration(); i++)
	    //{
	    	int a = hotel.getHotelID();
	    	
	    	String updateSQL= "UPDATE Dates SET \"010615\"=170 WHERE hotelID=10;";
	    	
		    //String updateSQL="UPDATE Dates SET \"" + dayList.get(i) + "\""+ "=174 WHERE hotelID=10;";
	    	
		    System.out.println(updateSQL);

		    try {
		    	
			      c = ConnectionDB.getDBConnection(DB_DRIVER, DB_CONNECTION);
			      System.out.println(1);
			      statement = c.prepareStatement(updateSQL);
			      /*
			      
			      //statement.setString(1, Integer.toString(request.getTotalRooms()));
			      statement.setString(1, Integer.toString(174));
			      statement.setInt(2, 10);
			  	*/
			      System.out.println(2);
			      ResultSet rs = statement.executeUpdate();
			      
while ( rs.next() ) {
			    	  
			    	  int id = rs.getInt("id");
				      String name = rs.getString("name");
				      String location = rs.getString("location");
				      int pricegroup  = rs.getInt("pricegroup");
				     int pricePerNight  = rs.getInt("pricePerNight");
				      int alwaysopen = rs.getInt("AlwaysOpen");
				      int bar = rs.getInt("Bar");
				      int wifi = rs.getInt("Wifi");
				      int ensuite = rs.getInt("ensuite"); 
				      int tv = rs.getInt("TV");
				      
				      Facilities facs = new Facilities(alwaysopen, bar, wifi, ensuite, tv);
				      Hotel hotel = new Hotel(id, name, location, pricegroup, pricePerNight, facs);
				      
				      hotels.add(hotel);
			      }
			      System.out.println(3);
		      rs.close();
		      statement.close();
		      c.close();
		    }
		    
		    catch ( Exception e ) {
		      System.err.println( e.getClass().getName() + ": " + e.getMessage() );
		      System.exit(0);
		    } 
	    //}
	    
	    
	}
}